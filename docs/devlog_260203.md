# Lottochu ê°œë°œ ì¼ì§€ - 2026.02.03

## í”„ë¡œì íŠ¸ ê°œìš”
- **ëª©ì **: ë¡œë˜ ë²ˆí˜¸ ì¶”ì²œ + ê²°ê³¼ ì•Œë¦¼ ìë™í™”
- **ê¸°ìˆ  ìŠ¤íƒ**: NestJS, Nx (ëª¨ë…¸ë ˆí¬), CQRS, PostgreSQL, Ollama (AI), Telegram Bot

---

## Phase 1: Nx ëª¨ë…¸ë ˆí¬ êµ¬ì¡° ì„¤ì •

### ì™„ë£Œëœ ì‘ì—…

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|------|----------|------|
| 12:15 | `feature/nx-cqrs-setup` ë¸Œëœì¹˜ ìƒì„± | âœ… |
| 12:16 | Nx ì´ˆê¸°í™” (`npx nx@latest init`) | âœ… |
| 12:17 | @nx/nest, @nx/node í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ | âœ… |
| 12:18 | ëª¨ë…¸ë ˆí¬ í´ë” êµ¬ì¡° ìƒì„± (apps/, libs/) | âœ… |
| 12:19 | ê¸°ì¡´ NestJS ì½”ë“œë¥¼ `apps/api`ë¡œ ì´ë™ | âœ… |
| 12:20 | tsconfig.base.json ìƒì„± (ê²½ë¡œ ë³„ì¹­ ì„¤ì •) | âœ… |
| 12:21 | project.json, jest.config.ts ë“± Nx ì„¤ì • íŒŒì¼ ìƒì„± | âœ… |
| 12:25 | @nx/webpack ì„¤ì¹˜ | âœ… |
| 12:26 | webpack.config.js ìƒì„± | âœ… |
| 12:27 | webpack-node-externalsë¡œ NestJS ë¹Œë“œ ë¬¸ì œ í•´ê²° | âœ… |
| 12:28 | `npx nx build api` ë¹Œë“œ ì„±ê³µ! | âœ… |
| 12:28 | `npx nx serve api` ì„œë²„ ì‹¤í–‰ ì„±ê³µ! | âœ… |

### ì´ìŠˆ ë° í•´ê²°

| ì´ìŠˆ | ì›ì¸ | í•´ê²° |
|------|------|------|
| @nx/node:build executor ì§€ì› ì•ˆë¨ | Nx 22.x ë²„ì „ ë³€ê²½ | @nx/webpack ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½ |
| NestJS optional deps ë¹Œë“œ ì—ëŸ¬ | webpackì´ ëª¨ë“  ëª¨ë“ˆ ë²ˆë“¤ë§ ì‹œë„ | webpack-node-externalsë¡œ ì™¸ë¶€ ëª¨ë“ˆ ì œì™¸ |

### ì§„í–‰ ì¤‘
- [x] ë¹Œë“œ í…ŒìŠ¤íŠ¸ âœ…
- [x] ë¼ì´ë¸ŒëŸ¬ë¦¬ êµ¬ì¡° ìƒì„± âœ…

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|------|----------|------|
| 12:30 | lotto ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„± | âœ… |
| 12:31 | shared ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„± | âœ… |
| 12:31 | statistics ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„± | âœ… |
| 12:31 | ai ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„± | âœ… |
| 12:32 | telegram ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„± | âœ… |
| 12:32 | scheduler ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„± | âœ… |

**ìƒì„±ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²½ë¡œ ë³„ì¹­:**
- `@lottochu/lotto` â†’ libs/lotto
- `@lottochu/shared` â†’ libs/shared
- `@lottochu/statistics` â†’ libs/statistics
- `@lottochu/ai` â†’ libs/ai
- `@lottochu/telegram` â†’ libs/telegram
- `@lottochu/scheduler` â†’ libs/scheduler

---

## Phase 1: PostgreSQL + TypeORM ì—°ë™

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|------|----------|------|
| 12:33 | @nestjs/typeorm, typeorm, pg, @nestjs/config ì„¤ì¹˜ | âœ… |
| 12:34 | .env, .env.example íŒŒì¼ ìƒì„± | âœ… |
| 12:35 | shared/config í´ë”ì— database.config.ts, app.config.ts ìƒì„± | âœ… |
| 12:36 | app.module.tsì— ConfigModule, TypeOrmModule ì„¤ì • | âœ… |
| 12:37 | ë¹Œë“œ í…ŒìŠ¤íŠ¸ ì„±ê³µ | âœ… |

---

## Phase 1: ì—”í‹°í‹° ì •ì˜

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|------|----------|------|
| 12:38 | lotto/domain/entities í´ë” êµ¬ì¡° ìƒì„± | âœ… |
| 12:39 | Draw ì—”í‹°í‹° ìƒì„± (ì—­ëŒ€ ë‹¹ì²¨ ë²ˆí˜¸) | âœ… |
| 12:40 | Recommendation ì—”í‹°í‹° ìƒì„± (ì¶”ì²œ ë²ˆí˜¸) | âœ… |
| 12:40 | Result ì—”í‹°í‹° ìƒì„± (ê²°ê³¼ ê¸°ë¡) | âœ… |
| 12:41 | LottoModuleì— TypeOrmModule.forFeature() ë“±ë¡ | âœ… |
| 12:42 | AppModuleì— LottoModule import | âœ… |
| 12:42 | ë¹Œë“œ í…ŒìŠ¤íŠ¸ ì„±ê³µ | âœ… |

### ìƒì„±ëœ ì—”í‹°í‹° êµ¬ì¡°

```typescript
// Draw - ì—­ëŒ€ ë‹¹ì²¨ ë²ˆí˜¸
{
  id: number,           // íšŒì°¨ (PK)
  drawDate: Date,       // ì¶”ì²¨ì¼
  numbers: number[],    // ë‹¹ì²¨ë²ˆí˜¸ [1,2,3,4,5,6]
  bonusNumber: number,  // ë³´ë„ˆìŠ¤
  prize1st: string,     // 1ë“± ë‹¹ì²¨ê¸ˆ
  winners1st: number,   // 1ë“± ë‹¹ì²¨ì ìˆ˜
}

// Recommendation - ì¶”ì²œ ë²ˆí˜¸
{
  id: UUID,
  targetDrawId: number,   // ëŒ€ìƒ íšŒì°¨
  type: STATISTICAL | AI, // ì¶”ì²œ íƒ€ì…
  gameNumber: number,     // ê²Œì„ ë²ˆí˜¸ (1~5)
  numbers: number[],      // ì¶”ì²œë²ˆí˜¸ 6ê°œ
  aiReasoning: string,    // AI ì¶”ì²œ ê·¼ê±°
}

// Result - ê²°ê³¼
{
  id: UUID,
  recommendationId: UUID,
  matchedCount: number,   // ì¼ì¹˜ ê°œìˆ˜ (0~6)
  matchedNumbers: number[],
  hasBonus: boolean,
  prizeRank: number,      // ë‹¹ì²¨ ë“±ìˆ˜
}
```

---

## Phase 2: ë™í–‰ë³µê¶Œ API ë° ë°ì´í„° ìˆ˜ì§‘

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|------|----------|------|
| 12:43 | @nestjs/axios, axios ì„¤ì¹˜ | âœ… |
| 12:44 | DhLotteryClient êµ¬í˜„ (ë™í–‰ë³µê¶Œ API í´ë¼ì´ì–¸íŠ¸) | âœ… |
| 12:45 | @nestjs/cqrs ì„¤ì¹˜ | âœ… |
| 12:46 | DrawRepository êµ¬í˜„ | âœ… |
| 12:47 | SyncDrawsCommand + Handler êµ¬í˜„ (CQRS) | âœ… |
| 12:48 | LottoController êµ¬í˜„ (API ì—”ë“œí¬ì¸íŠ¸) | âœ… |

### CQRS êµ¬ì¡°

```
libs/lotto/
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ entities/           # ì—”í‹°í‹°
â”œâ”€â”€ application/
â”‚   â””â”€â”€ commands/           # CQRS Commands
â”‚       â”œâ”€â”€ sync-draws.command.ts
â”‚       â””â”€â”€ sync-draws.handler.ts
â”œâ”€â”€ infrastructure/
â”‚   â””â”€â”€ repositories/       # Repository
â”‚       â””â”€â”€ draw.repository.ts
â””â”€â”€ interfaces/
    â””â”€â”€ lotto.controller.ts # REST API
```

### API ì—”ë“œí¬ì¸íŠ¸

| Method | URL | ì„¤ëª… |
|--------|-----|------|
| POST | `/lotto/sync` | ë™í–‰ë³µê¶Œì—ì„œ ë‹¹ì²¨ë²ˆí˜¸ ë™ê¸°í™” |
| GET | `/lotto/draws` | ì €ì¥ëœ ëª¨ë“  ë‹¹ì²¨ë²ˆí˜¸ ì¡°íšŒ |
| GET | `/lotto/draws/latest` | ìµœì‹  ë‹¹ì²¨ë²ˆí˜¸ ì¡°íšŒ |
| GET | `/lotto/status` | DB ìƒíƒœ í™•ì¸ |

---

## Phase 2: í†µê³„ ê³„ì‚° ì„œë¹„ìŠ¤

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|------|----------|------|
| 12:49 | StatisticsService êµ¬í˜„ (ë²ˆí˜¸ë³„ ì¶œí˜„ ë¹ˆë„ ê³„ì‚°) | âœ… |
| 12:50 | getCandidateNumbers() - í•˜ìœ„ 20ê°œ ì œì™¸ ë¡œì§ | âœ… |
| 12:51 | StatisticsController êµ¬í˜„ | âœ… |
| 12:52 | StatisticsModule â†’ AppModule ë“±ë¡ | âœ… |

### í†µê³„ API ì—”ë“œí¬ì¸íŠ¸

| Method | URL | ì„¤ëª… |
|--------|-----|------|
| GET | `/statistics` | ì „ì²´ í†µê³„ ì¡°íšŒ |
| GET | `/statistics/candidates?exclude=20` | í›„ë³´ ë²ˆí˜¸ ì¡°íšŒ (í•˜ìœ„ Nê°œ ì œì™¸) |
| GET | `/statistics/most-frequent` | ê°€ì¥ ë§ì´ ë‚˜ì˜¨ ë²ˆí˜¸ TOP 10 |
| GET | `/statistics/least-frequent` | ê°€ì¥ ì ê²Œ ë‚˜ì˜¨ ë²ˆí˜¸ TOP 10 |

---

## Phase 3: ì¶”ì²œ ì—”ì§„ (í†µê³„ + AI)

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|------|----------|------|
| 12:53 | GenerateRecommendationCommand + Handler êµ¬í˜„ | âœ… |
| 12:54 | í†µê³„ ê¸°ë°˜ ì¶”ì²œ (í•˜ìœ„ 20ê°œ ì œì™¸) êµ¬í˜„ | âœ… |
| 12:55 | OllamaClient êµ¬í˜„ (Ollama API ì—°ë™) | âœ… |
| 12:56 | AiService êµ¬í˜„ | âœ… |
| 12:57 | GenerateRecommendationHandlerì— AI ì„œë¹„ìŠ¤ í†µí•© | âœ… |

### ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜

**í†µê³„ ê¸°ë°˜ (3ê²Œì„):**
```
1. ì—­ëŒ€ ë‹¹ì²¨ ë²ˆí˜¸ì—ì„œ ê° ë²ˆí˜¸(1~45) ì¶œí˜„ ë¹ˆë„ ê³„ì‚°
2. ì¶œí˜„ ë¹ˆë„ í•˜ìœ„ 20ê°œ ë²ˆí˜¸ ì œì™¸
3. ë‚˜ë¨¸ì§€ 25ê°œ ì¤‘ ëœë¤ 6ê°œ ì„ íƒ
4. 3ì„¸íŠ¸ ë°˜ë³µ ìƒì„±
```

**AI ê¸°ë°˜ (2ê²Œì„):**
```
1. ìµœê·¼ 10íšŒì°¨ ë‹¹ì²¨ ë²ˆí˜¸ ìˆ˜ì§‘
2. Ollama (llama3.2:8b)ì— í”„ë¡¬í”„íŠ¸ ì „ì†¡
3. AI ì‘ë‹µ íŒŒì‹± â†’ 2ì„¸íŠ¸ ìƒì„±
4. Ollama ì—°ê²° ì‹¤íŒ¨ ì‹œ ëœë¤ ìƒì„± (fallback)
```

---

## Phase 4: í…”ë ˆê·¸ë¨ ë´‡ ì—°ë™

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|------|----------|------|
| 12:58 | telegraf íŒ¨í‚¤ì§€ ì„¤ì¹˜ | âœ… |
| 12:59 | TelegramService êµ¬í˜„ | âœ… |
| 13:00 | ì¶”ì²œ/ê²°ê³¼ ë©”ì‹œì§€ í¬ë§·íŒ… | âœ… |

---

## Phase 5: ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|------|----------|------|
| 13:01 | @nestjs/schedule ì„¤ì¹˜ | âœ… |
| 13:02 | SchedulerService êµ¬í˜„ | âœ… |
| 13:03 | Cron ì‘ì—… ë“±ë¡ | âœ… |

### ìŠ¤ì¼€ì¤„ëŸ¬ ì‘ì—…

| ì‹œê°„ | ì‘ì—… | Cron |
|------|------|------|
| ì›”ìš”ì¼ 09:00 | ì´ë²ˆ ì£¼ ì¶”ì²œ ë²ˆí˜¸ ìƒì„± + í…”ë ˆê·¸ë¨ ë°œì†¡ | `0 9 * * 1` |
| í† ìš”ì¼ 21:00 | ë‹¹ì²¨ ê²°ê³¼ í™•ì¸ | `0 21 * * 6` |
| í† ìš”ì¼ 21:30 | í†µê³„ ê°±ì‹  | `30 21 * * 6` |

---

---

## í…ŒìŠ¤íŠ¸ ë° í™˜ê²½ ì„¤ì •

| ì‹œê°„ | ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|------|----------|------|
| 23:32 | `npx nx serve api` ì‹¤í–‰ | âœ… |
| 23:32 | StatisticsModule ìˆœí™˜ ì˜ì¡´ì„± ì—ëŸ¬ ë°œìƒ | âš ï¸ |
| 23:33 | StatisticsServiceì—ì„œ DataSource ì§ì ‘ ì‚¬ìš©ìœ¼ë¡œ ìˆ˜ì • | âœ… |
| 23:34 | PostgreSQL ì—°ê²° ì‹¤íŒ¨ (ECONNREFUSED) | âš ï¸ |
| 23:35 | PostgreSQL ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ (ë¯¸ì‹¤í–‰) | âš ï¸ |
| 23:36 | `pg_ctl start` ëª…ë ¹ìœ¼ë¡œ PostgreSQL ì‹œì‘ | âœ… |
| 23:37 | pgAdmin ì‹¤í–‰ ì˜¤ë¥˜ (ëª¨ë“ˆ ë¬¸ì œ) | âš ï¸ |
| 23:38 | PostgreSQL ë¹„ë°€ë²ˆí˜¸ í•„ìš” - ëŒ€ê¸° ì¤‘ | ğŸ”„ |

### í•´ê²°í•œ ì´ìŠˆ

| ì´ìŠˆ | ì›ì¸ | í•´ê²° |
|------|------|------|
| StatisticsService ì˜ì¡´ì„± ì£¼ì… ì‹¤íŒ¨ | LottoModuleê³¼ ìˆœí™˜ ì°¸ì¡° | DataSource ì§ì ‘ ì‚¬ìš© (Raw Query) |
| PostgreSQL ì—°ê²° ë¶ˆê°€ | ì„œë¹„ìŠ¤ ë¯¸ì‹¤í–‰ | `pg_ctl start -D "...\data"` |

### ë‚¨ì€ ì‘ì—…

- [ ] PostgreSQL ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í›„ `lottochu` ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
- [ ] ì„œë²„ ì‹¤í–‰ ë° í…Œì´ë¸” ìë™ ìƒì„± í™•ì¸
- [ ] `/lotto/sync` APIë¡œ ë‹¹ì²¨ë²ˆí˜¸ ë™ê¸°í™” í…ŒìŠ¤íŠ¸
- [ ] `/lotto/recommend` APIë¡œ ë²ˆí˜¸ ì¶”ì²œ í…ŒìŠ¤íŠ¸

---

## ğŸ‰ Phase 1~5 ì™„ë£Œ!

### ìµœì¢… í”„ë¡œì íŠ¸ êµ¬ì¡°

```
lottochu/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ api/                          # NestJS ì•±
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ main.ts
â”‚           â””â”€â”€ app.module.ts
â”œâ”€â”€ libs/
â”‚   â”œâ”€â”€ lotto/                        # ë¡œë˜ í•µì‹¬ ë„ë©”ì¸
â”‚   â”‚   â”œâ”€â”€ domain/entities/          # Draw, Recommendation, Result
â”‚   â”‚   â”œâ”€â”€ application/commands/     # CQRS Commands
â”‚   â”‚   â”œâ”€â”€ infrastructure/repos/     # Repositories
â”‚   â”‚   â””â”€â”€ interfaces/               # Controllers
â”‚   â”œâ”€â”€ statistics/                   # í†µê³„ ë¶„ì„
â”‚   â”œâ”€â”€ ai/                           # Ollama AI ì—°ë™
â”‚   â”œâ”€â”€ telegram/                     # í…”ë ˆê·¸ë¨ ë´‡
â”‚   â”œâ”€â”€ scheduler/                    # ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â””â”€â”€ shared/                       # ê³µí†µ ì„¤ì •, í´ë¼ì´ì–¸íŠ¸
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ devlog_260203.md
â”œâ”€â”€ .env
â””â”€â”€ .env.example
```

### API ì—”ë“œí¬ì¸íŠ¸ ìš”ì•½

| Method | URL | ì„¤ëª… |
|--------|-----|------|
| POST | `/lotto/sync` | ë™í–‰ë³µê¶Œì—ì„œ ë‹¹ì²¨ë²ˆí˜¸ ë™ê¸°í™” |
| POST | `/lotto/recommend` | ë¡œë˜ ë²ˆí˜¸ ì¶”ì²œ ìƒì„± (5ê²Œì„) |
| GET | `/lotto/draws` | ì €ì¥ëœ ë‹¹ì²¨ë²ˆí˜¸ ì¡°íšŒ |
| GET | `/lotto/status` | DB ìƒíƒœ í™•ì¸ |
| GET | `/statistics` | ì „ì²´ í†µê³„ |
| GET | `/statistics/candidates` | í›„ë³´ ë²ˆí˜¸ (í•˜ìœ„ 20ê°œ ì œì™¸) |

---

## ì˜ˆì • ì‘ì—…

### Phase 1 (ê³„ì†)
- [ ] ë¹Œë“œ ì„¤ì • ê²€ì¦
- [ ] ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒì„± (lotto, statistics, ai, telegram, scheduler, shared)
- [ ] PostgreSQL + TypeORM ì—°ë™
- [ ] ì—”í‹°í‹° ì •ì˜ (draws, recommendations, results)

### Phase 2
- [ ] ë™í–‰ë³µê¶Œ API í´ë¼ì´ì–¸íŠ¸
- [ ] ì—­ëŒ€ ë‹¹ì²¨ë²ˆí˜¸ ìˆ˜ì§‘ Command
- [ ] í†µê³„ ê³„ì‚° ì„œë¹„ìŠ¤

### Phase 3
- [ ] í†µê³„ ê¸°ë°˜ ì¶”ì²œ ì—”ì§„ (í•˜ìœ„ 20ê°œ ë²ˆí˜¸ ì œì™¸)
- [ ] Ollama AI í´ë¼ì´ì–¸íŠ¸
- [ ] AI ê¸°ë°˜ ì¶”ì²œ ì—”ì§„

### Phase 4
- [ ] í…”ë ˆê·¸ë¨ ë´‡ ì—°ë™

### Phase 5
- [ ] ìŠ¤ì¼€ì¤„ëŸ¬ (ì›”ìš”ì¼ ì¶”ì²œ, í† ìš”ì¼ ê²°ê³¼)

---

## ì£¼ìš” ì„¤ê³„ ê²°ì •

### ì•Œê³ ë¦¬ì¦˜
1. **í†µê³„ ê¸°ë°˜ ì¶”ì²œ (3ê²Œì„)**
   - ì—­ëŒ€ ëª¨ë“  ë‹¹ì²¨ ë²ˆí˜¸ ì¡°íšŒ
   - ê° ë²ˆí˜¸(1~45) ì¶œí˜„ ë¹ˆë„ ê³„ì‚°
   - **ì¶œí˜„ ë¹ˆë„ í•˜ìœ„ 20ê°œ ë²ˆí˜¸ ì œì™¸**
   - ë‚˜ë¨¸ì§€ 25ê°œ ì¤‘ ëœë¤ 6ê°œ ì„ íƒ
   - 3ì„¸íŠ¸ ë°˜ë³µ ìƒì„±

2. **AI ê¸°ë°˜ ì¶”ì²œ (2ê²Œì„)**
   - Ollama (llama3.2:8b) ì‚¬ìš© (ë¬´ë£Œ)
   - ìµœê·¼ ë‹¹ì²¨ íŒ¨í„´ ë¶„ì„ í›„ ì¶”ì²œ

### í´ë” êµ¬ì¡°
```
lottochu/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ api/                 # NestJS ì•±
â”œâ”€â”€ libs/
â”‚   â”œâ”€â”€ lotto/              # ë¡œë˜ í•µì‹¬ ë„ë©”ì¸ + CQRS
â”‚   â”œâ”€â”€ statistics/         # í†µê³„ ë¶„ì„
â”‚   â”œâ”€â”€ ai/                 # Ollama AI ì—°ë™
â”‚   â”œâ”€â”€ telegram/           # í…”ë ˆê·¸ë¨ ë´‡
â”‚   â”œâ”€â”€ scheduler/          # ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â””â”€â”€ shared/             # ê³µí†µ ìœ í‹¸
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ devlog_YYMMDD.md    # ë‚ ì§œë³„ ê°œë°œ ì¼ì§€
â””â”€â”€ README.md
```
